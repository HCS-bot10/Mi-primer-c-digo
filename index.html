<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Atrapa mi corazÃ³n â€” Para Miguel ðŸ’˜</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    html,body{
      height:100%; margin:0;
      font-family:'Poppins', Arial, sans-serif;
      background: radial-gradient(circle at top left, #ffd6e8, #ffe5ec, #fff0f6);
    }
    #wrap{
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      height:100%;
      text-align:center;
    }
    h1{
      color:#ff4d79;
      margin-bottom:10px;
      font-size:1.6rem;
      font-weight:600;
    }
    canvas{
      border-radius:20px;
      box-shadow:0 8px 25px rgba(255, 102, 153, .3);
      background:white;
    }
    .hud{
      margin-top:16px;
      display:flex; gap:10px; align-items:center; justify-content:center;
      font-size:1.1rem;
      color:#ff4d79;
    }
    button{
      padding:8px 14px;
      border-radius:10px;
      border:none;
      background:#ff85a2;
      color:white;
      cursor:pointer;
      transition:background 0.3s;
    }
    button:hover{ background:#ff4d79; }
  </style>
</head>
<body>
  <div id="wrap">
    <h1>ðŸ’˜ Atrapa mi corazÃ³n ðŸ’˜</h1>
    <canvas id="c" width="480" height="360"></canvas>
    <div class="hud">
      <div>ðŸ’ž Puntos de amor: <strong id="score">0</strong></div>
      <button id="restart">Volver a jugar</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const restartBtn = document.getElementById('restart');

    let heart = { x:240, y:150, r:18, vx:2.8, vy:2.4 };
    let lover = { x:240, y:320, w:80, h:12 };
    let score = 0, running = true;

    function drawHeart(x, y, size, color){
      ctx.save();
      ctx.translate(x, y);
      ctx.scale(size/50, size/50);
      ctx.beginPath();
      ctx.moveTo(0, 15);
      ctx.bezierCurveTo(20, -15, 50, 10, 0, 50);
      ctx.bezierCurveTo(-50, 10, -20, -15, 0, 15);
      ctx.fillStyle = color;
      ctx.fill();
      ctx.restore();
    }

    function reset(){
      heart = { x:240, y:80, r:18, vx:2.5 + Math.random()*1.5, vy:2 + Math.random()*1.5 };
      score = 0;
      running = true;
      scoreEl.textContent = score;
      requestAnimationFrame(loop);
    }

    restartBtn.onclick = reset;

    // Nueva funciÃ³n para obtener la posiciÃ³n del mouse relativa al canvas
    function getMousePos(evt) {
      const rect = canvas.getBoundingClientRect();
      return {
        x: (evt.clientX - rect.left) * (canvas.width / rect.width),
        y: (evt.clientY - rect.top) * (canvas.height / rect.height)
      };
    }

    canvas.addEventListener('mousemove', (e) => {
      const pos = getMousePos(e);
      lover.x = Math.max(lover.w/2, Math.min(canvas.width - lover.w/2, pos.x));
    });

    canvas.addEventListener('click', () => {
      heart.vy -= 1.3;
      score += 1;
      scoreEl.textContent = score;
    });

    function loop(){
      if(!running) return;
      heart.x += heart.vx;
      heart.y += heart.vy;
      heart.vy += 0.05;

      if(heart.x - heart.r < 0 || heart.x + heart.r > canvas.width) heart.vx *= -1;
      if(heart.y - heart.r < 0) heart.vy *= -1;

      if(heart.y + heart.r >= lover.y - lover.h/2 &&
         heart.y + heart.r <= lover.y + lover.h &&
         heart.x >= lover.x - lover.w/2 &&
         heart.x <= lover.x + lover.w/2 &&
         heart.vy > 0){
        heart.vy *= -0.9;
        heart.vx += (Math.random()-0.5)*0.6;
        score += 2;
        scoreEl.textContent = score;
      }

      if(heart.y - heart.r > canvas.height + 20){
        running = false;
        setTimeout(()=>{
          ctx.fillStyle = 'rgba(0,0,0,0.45)';
          ctx.fillRect(0,0,canvas.width,canvas.height);
          ctx.fillStyle = 'white';
          ctx.font = '20px "Poppins", sans-serif';
          ctx.textAlign = 'center';
          ctx.fillText('ðŸ’” Mi corazÃ³n cayÃ³... pero siempre vuelve a ti, Miguel ðŸ’”', canvas.width/2, canvas.height/2);
          ctx.fillText('Haz click en "Volver a jugar" para seguir amÃ¡ndome ðŸ’ž', canvas.width/2, canvas.height/2 + 30);
        },100);
      }

      draw();
      if(running) requestAnimationFrame(loop);
    }

    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawHeart(heart.x, heart.y, heart.r*2, '#ff4d79');
      ctx.fillStyle = '#ffb6c1';
      ctx.fillRect(lover.x - lover.w/2, lover.y - lover.h/2, lover.w, lover.h);
    }

    reset();
    loop();
  </script>
</body>
</html>
